{% extends 'base.html' %}
{% load static %}
{% block title %}Reader{% endblock %}

{% block content %}
    <div class="container mt-5">
    <!-- Заголовок книги та опис -->
    <h1>{{ book.title }}</h1>
    <p>{{ book.description }}</p>

{% if messages %}
    <div id="message-alert" class="alert alert-success alert-dismissible fade show" role="alert" style="position: fixed; top: 220px; left: 50%; transform: translateX(-50%); z-index: 9999; width: 80%; max-width: 800px; font-size: 18px; text-align: center;">
        {% for message in messages %}
            <p>{{ message }}</p>
        {% endfor %}
        <!-- Кнопка закриття -->
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
{% endif %}

    <!-- Рідер PDF -->
    <iframe id="pdfViewer" src="{% static 'pdfjs/web/viewer.html' %}?file={{ book.file.url }}"
            width="100%" height="900px" style="border: none;"></iframe>

    <!-- Теги книги (гармонійне оформлення з Bootstrap) -->
    <div class="tags mt-4">
        <h5>Працює пошук за тегами:</h5>
        <div class="d-flex flex-wrap gap-2">
            {% for tag in book.tags.all %}
                <span class="badge rounded-pill bg-success text-light py-2 px-3">{{ tag.name }}</span>
            {% endfor %}
        </div>
    </div>

<div class="d-flex justify-content-center gap-3 mt-4">
        <a href="{% url 'library:recommend_book' book.slug %}"><button type="button" class="btn btn-primary btn-lg">Рекомендувати книгу</button></a>
        <a href="{% url 'library:comment_book' book.slug %}"><button type="button" class="btn btn-success btn-lg">Залишити коментар</button></a>
    </div>
</div>

<!-- Коментарі -->
<div class="container mt-5">
    <h3>Коментарі</h3>
    <div id="comments-section">
        <!-- Секція з коментарями -->
        {% for comment in book.comments.all %}
            <div class="comment">
                <p>Comment {{ forloop.counter }} by<strong> {{ comment.name }}</strong>:<br>{{ comment.body }}</p>
            </div>
        {% endfor %}
    </div>

    <!-- Горизонтальні кнопки -->





    <!-- Рекомендації схожих книг -->
{#    <div class="similar-books mt-5">#}
{#        <h5>Схожі книги</h5>#}
{#        <div class="d-flex overflow-auto">#}
{#            {% for similar_book in similar_books %}#}
{#                <div class="card me-3" style="width: 18rem;">#}
{#                    <img src="{{ similar_book.image.url }}" class="card-img-top" alt="{{ similar_book.title }}">#}
{#                    <div class="card-body">#}
{#                        <h6 class="card-title">{{ similar_book.title }}</h6>#}
{#                        <a href="{% url 'book_detail' similar_book.id %}" class="btn btn-outline-info btn-sm">Переглянути</a>#}
{#                    </div>#}
{#                </div>#}
{#            {% endfor %}#}
{#        </div>#}
{#    </div>#}
</div>

{#<script>#}
{#    // Збереження останньої сторінки в LocalStorage#}
{#    window.addEventListener("message", function (e) {#}
{#        if (e.origin === window.location.origin && e.data.type === "page") {#}
{#            localStorage.setItem("lastPage_{{ book.id }}", e.data.pageNumber); // Унікальний ключ для кожної книги#}
{#        }#}
{#    });#}
{##}
{#    // Завантаження останньої сторінки#}
{#    document.addEventListener("DOMContentLoaded", function () {#}
{#        const lastPage = localStorage.getItem("lastPage_{{ book.id }}");#}
{#        const pdfViewer = document.getElementById("pdfViewer");#}
{#        if (lastPage) {#}
{#            pdfViewer.src += `#page=${lastPage}`; // Додаємо параметр для відкриття останньої сторінки#}
{#        }#}
{#    });#}
{#</script>#}
<script type="text/javascript">
    window.onload = function() {
        var alert = document.getElementById("message-alert");
        if (alert) {
            setTimeout(function() {
                alert.classList.remove("show");
                alert.classList.add("fade");
            }, 3000);  // 3000 мс = 3 секунди
        }
    };
</script>
{% endblock %}
